#!/usr/bin/with-contenv bash

VARNISH_TTL=${VARNISH_TTL:-120}
VARNISH_VCL_CONF=${VARNISH_VCL_CONF:-/etc/varnish/default.vcl}
VARNISH_SECRET_FILE=${VARNISH_SECRET_FILE:-/etc/varnish/secret}
VARNISH_LISTEN_PORT=${VARNISH_LISTEN_PORT:-80}
VARNISH_ADMIN_LISTEN_PORT=${VARNISH_ADMIN_LISTEN_PORT:-6082}
VARNISH_STORAGE_SIZE=${VARNISH_CACHE_SIZE:-64M}
VARNISH_STORAGE=${VARNISH_STORAGE:-"malloc,$VARNISH_STORAGE_SIZE"}
VARNISHD_PARAMS=${VARNISHD_PARAMS:-}

exec \
    /usr/sbin/varnishd \
        -F \
        -a :${VARNISH_LISTEN_PORT} \
        -T :${VARNISH_ADMIN_LISTEN_PORT} \
        -f ${VARNISH_VCL_CONF} \
        -S ${VARNISH_SECRET_FILE} \
        -t ${VARNISH_TTL} \
        -s ${VARNISH_STORAGE} \
        ${VARNISHD_PARAMS}
